<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ø§Ø¹Ø¯ Ø³ÙŠØ§Ø­ÙŠ</title>
<style>
:root {
    --dark-bg: #121212;
    --card-bg: #1f1f1f;
    --gold: #ffc107;
    --blue-royal: #4a6fa5;
    --white: #e0e0e0;
    --border-color: #333333;
    --red-emergency: #cf6679;
    --green-success: #4caf50;
    --yellow-warning: #ffeb3b;
    --text-color: #e0e0e0;
}
body {background-color: var(--dark-bg); color: var(--text-color); font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; padding:0; direction:rtl;}
.header-controls {display:flex; justify-content:flex-end; padding:15px; background-color:#1f1f1f; border-bottom:1px solid var(--border-color);}
.btn-back {background-color:var(--blue-royal); color:#fff; padding:8px 15px; border-radius:6px; text-decoration:none; font-size:0.9em; transition:background-color 0.3s; border:none; cursor:pointer; margin-left:10px;}
.btn-back:hover {background-color:#3b5b82;}
.cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; margin-top: 30px; }
.assistant-card { background-color: #2a2a2a; border-radius: 10px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.4); border:1px solid var(--blue-royal); position: relative; transition: transform 0.3s,border-color 0.3s; }
.assistant-card:hover { transform: translateY(-5px); border-color: var(--gold); }
.card-header { display:flex; align-items:center; margin-bottom:15px; border-bottom:1px dashed #444; padding-bottom:10px; }
.profile-img { width:70px; height:70px; border-radius:50%; object-fit:cover; border:2px solid var(--gold); margin-left:15px; }
.card-header h3 { color:var(--gold); margin:0; font-size:1.4em; }
.card-details p { margin:8px 0; text-align:right; font-size:0.95em; color:#ccc; }
.card-details strong { color:var(--white); }
.rating { color: var(--yellow-warning); font-size:1.1em; margin-top:5px; line-height:1.2em; }
.contact-btn, .comments-btn { background-color:var(--green-success); color:var(--dark-bg); padding:10px; width:100%; border:none; border-radius:6px; font-weight:bold; margin-top:10px; cursor:pointer; transition: background-color 0.3s; }
.contact-btn:hover, .comments-btn:hover { background-color:#388e3c; }
.role-title { text-align:center; color:var(--white); background-color:var(--blue-royal); padding:10px; border-radius:8px; margin-bottom:20px; }
.modal-bg { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:1000; justify-content:center; align-items:center; }
.modal-content { background:#1f1f1f; padding:20px; border-radius:10px; width:90%; max-width:500px; max-height:80%; overflow-y:auto; position:relative; }
.close-modal { position:absolute; top:10px; right:10px; background:var(--red-emergency); color:#fff; border:none; border-radius:50%; width:25px; height:25px; cursor:pointer; }
.comment-item { margin-bottom:8px; line-height:1.3em; padding-bottom:5px; border-bottom:1px dashed #444; display: flex; justify-content: space-between; align-items: center; }
.comment-info { flex-grow: 1; }
.comment-name { font-weight:bold; color:var(--gold); display:block; margin-bottom:2px; }
.comment-stars { display:block; color:var(--yellow-warning); margin-bottom:2px; }
.comment-text { display:block; color:#ccc; text-align:right; }
.comment-input, .rating-select { width:100%; padding:6px; margin-top:5px; border-radius:4px; border:1px solid var(--blue-royal); background-color:#2a2a2a; color:#fff; }
.comment-submit { margin-top:5px; padding:6px 12px; border:none; border-radius:6px; background-color:var(--blue-royal); color:#fff; cursor:pointer; }
.comment-submit:hover { background-color:#3b5b82; }
.filter-input { width: 100%; padding: 12px; margin-bottom: 20px; border-radius: 6px; border: 1px solid var(--blue-royal); background-color: #2a2a2a; color: var(--white); font-size: 1em; }
.delete-comment-btn { background-color: var(--red-emergency); color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8em; margin-right: 5px; }
</style>
</head>
<body>
<div class="header-controls">
    <a href="main_services.html" class="btn-back">ğŸ”™ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
</div>
<div class="container" style="max-width:1000px;">
    <h1 id="pageHeading">Ø§Ù‡Ù„Ø§ Ø¨Ùƒ ÙŠØ§ Ø²Ø§Ø¦Ø±Ù†Ø§ Ø§Ù„Ø¹Ø²ÙŠØ²</h1>
    <div class="role-title" id="roleTitleDisplay">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†</div>
    <input type="text" id="assistantSearch" class="filter-input" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø£Ùˆ Ø§Ù„ØªØ®ØµØµ..." onkeyup="filterAssistants()">
    
    <div id="assistantCardsGrid" class="cards-grid"></div>
</div>

<div id="commentsModal" class="modal-bg">
    <div class="modal-content">
        <button class="close-modal" onclick="closeCommentsModal()">Ã—</button>
        <h3 id="modalAssistantName"></h3>
        <div id="modalCommentsList"></div>
        <input type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ..." id="modalCommentName" class="comment-input">
        <input type="text" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹..." id="modalCommentText" class="comment-input">
        <select id="modalCommentRating" class="rating-select">
            <option value="1">â­ 1</option>
            <option value="2">â­ 2</option>
            <option value="3">â­ 3</option>
            <option value="4">â­ 4</option>
            <option value="5" selected>â­ 5</option>
        </select>
        <button onclick="submitModalComment()" class="comment-submit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</button>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get, push, set, remove } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
apiKey: "AIzaSyDpVqFWJfB4rA2-NA4QIl1w07e2LFQaYic",
authDomain: "tourguideapp-313c1.firebaseapp.com",
databaseURL: "https://tourguideapp-313c1-default-rtdb.firebaseio.com",
projectId: "tourguideapp-313c1",
storageBucket: "tourguideapp-313c1.appspot.com",
messagingSenderId: "1036127588385",
appId: "1:1036127588385:web:d144dba8f70fe094395360"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Ù‚Ø§Ø¦Ù…Ø© Ø¹Ø§Ù…Ø© Ù„Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† Ù„Ù„ÙÙ„ØªØ±Ø©
let allAssistants = [];

const ROLES = {
GUIDE: {key:"GUIDE", name:"Ù…Ø±Ø´Ø¯ Ø³ÙŠØ§Ø­ÙŠ"},
COMPANION: {key:"COMPANION", name:"Ù…Ø±Ø§ÙÙ‚ Ù„Ø°ÙˆÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø®Ø§ØµØ©"},
DRIVER: {key:"DRIVER", name:"Ø³Ø§Ø¦Ù‚ Ù†Ù‚Ù„ Ø®Ø§Øµ"}
};

const keyMap = { GUIDE:'assistants_guides', COMPANION:'assistants_companions', DRIVER:'assistants_drivers' };

// â­ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
function renderStars(rating){
let stars='';
for(let i=1;i<=5;i++) stars+=i<=rating?'â­':'â˜†';
return stars;
}

function getMajorityRating(comments){
if(!comments || comments.length===0) return 5;
// ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§Ø¦Ù† Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
const commentsArray = Array.isArray(comments) ? comments : Object.values(comments);
const counts={};
commentsArray.forEach(c=>counts[c.rating]=(counts[c.rating]||0)+1);
let max=0, majority=5;
for(const r in counts){ if(counts[r]>max){ max=counts[r]; majority=parseInt(r); } }
return majority;
}

// Ø§Ù„Ù…ÙˆØ¯Ù„
let currentModalCode = null;
function openCommentsModal(code,name){
currentModalCode=code;
document.getElementById('modalAssistantName').textContent=name;
loadModalComments(code);
document.getElementById('commentsModal').style.display='flex';
}
function closeCommentsModal(){
document.getElementById('commentsModal').style.display='none';
currentModalCode=null;
}
async function loadModalComments(code){
const div=document.getElementById('modalCommentsList');
div.innerHTML='<p style="text-align:center;color:#ccc;">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª...</p>';

try {
    // 1. Ø¬Ù„Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù…Ù† Firebase Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØ§ØªÙŠØ­ (Keys) Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ø­Ø°Ù
    const snap = await get(ref(db, `assistantComments/${code}`));
    const commentsData = snap.val() || {};
    const commentsArrayWithKeys = [];

    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§Ø¦Ù† Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© Ù…Ø¹ ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù…ÙØªØ§Ø­ (key)
    for (const key in commentsData) {
        if (commentsData.hasOwnProperty(key)) {
            commentsArrayWithKeys.push({ firebaseKey: key, ...commentsData[key] });
        }
    }

    // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© (localStorage) Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
    localStorage.setItem(`comments_${code}`, JSON.stringify(Object.values(commentsData)));
    
    div.innerHTML='';
    if(commentsArrayWithKeys.length === 0){
        div.innerHTML='<p style="text-align:center;color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>';
        return;
    }

    // 3. Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù…Ø¹ Ø²Ø± Ø§Ù„Ø­Ø°Ù
    commentsArrayWithKeys.slice(-20).forEach(c=>{
        const el=document.createElement('div');
        el.className='comment-item';
        el.innerHTML=`
            <span class="comment-info">
                <span class="comment-name">${c.name||'Ø²Ø§Ø¦Ø±'}</span>
                <span class="comment-stars">${renderStars(c.rating)}</span>
                <span class="comment-text">${c.text}</span>
            </span>
            <button class="delete-comment-btn" onclick="deleteComment('${code}', '${c.firebaseKey}')">Ø­Ø°Ù</button>
        `;
        div.appendChild(el);
    });

} catch (error) {
    console.error("Error loading comments:", error);
    div.innerHTML='<p style="text-align:center;color:var(--red-emergency);">ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª.</p>';
}
}
async function submitModalComment(){
if(!currentModalCode) return;
const name = document.getElementById('modalCommentName').value.trim() || "Ø²Ø§Ø¦Ø±";
const text = document.getElementById('modalCommentText').value.trim();
const rating = parseInt(document.getElementById('modalCommentRating').value);
if(!text) return;
const comment = {name,text,rating, timestamp: Date.now()};

try {
    // Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase
    const newRef = push(ref(db, `assistantComments/${currentModalCode}`));    
    await set(newRef, comment);    
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„
    document.getElementById('modalCommentName').value='';    
    document.getElementById('modalCommentText').value='';    
    document.getElementById('modalCommentRating').value='5';    
    await loadModalComments(currentModalCode); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù…Ù† Firebase Ù„ØªØ­Ø¯ÙŠØ« localStorage
    
    // ØªØ­Ø¯ÙŠØ« ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠØŒ ÙŠØªØ·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© renderCards)
    renderCards(allAssistants, document.getElementById('roleTitleDisplay').textContent);


} catch(error) {
    alert("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚: " + error.message);
}
}

// Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„ÙØ±Ø¯ÙŠ
async function deleteComment(assistantCode, commentKey) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ØŸ')) return;
    try {
        await remove(ref(db, `assistantComments/${assistantCode}/${commentKey}`));
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
        await loadModalComments(assistantCode); 
    } catch (error) {
        alert("ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚: " + error.message);
        console.error("Error deleting comment:", error);
    }
}


// Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
function renderCards(assistantsList,title){
document.getElementById('roleTitleDisplay').textContent = title;
const grid = document.getElementById('assistantCardsGrid');
grid.innerHTML='';

if(assistantsList.length===0){ grid.innerHTML='<p style="text-align:center;color:#aaa;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³Ø§Ø¹Ø¯ÙˆÙ† Ù…ØªØ§Ø­ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.</p>'; return; }

assistantsList.forEach(a=>{
const card = document.createElement('div');
card.className='assistant-card';
card.setAttribute('data-id', a.appId); 
card.setAttribute('data-name', a.name);
card.setAttribute('data-type', a.guideType || a.specialization || a.role); // Ù„Ù„ÙÙ„ØªØ±Ø©

let details='';    
    if(a.groupLimit){ details+=`<p><strong>Ø§Ù„ØªØ®ØµØµ:</strong> ${a.guideType||'Ø¹Ø§Ù…'}</p><p><strong>Ø­Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</strong> ${a.groupLimit} Ø´Ø®Øµ</p><p><strong>Ø³Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…:</strong> ${a.price} Ø¯Ø±Ù‡Ù…</p>`; }    
    else if(a.specialization){ details+=`<p><strong>Ø§Ù„ØªØ®ØµØµ:</strong> ${a.specialization}</p><p><strong>Ø³Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…:</strong> ${a.priceDay} Ø¯Ø±Ù‡Ù…</p><p><strong>Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø©:</strong> ${a.priceHour} Ø¯Ø±Ù‡Ù…</p>`; }    
    else if(a.cityPrice){ details+=`<p><strong>Ø£Ø¬Ø±Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${a.cityPrice} Ø¯Ø±Ù‡Ù…</p><p><strong>Ø£Ø¬Ø±Ø© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${a.outCityPrice} Ø¯Ø±Ù‡Ù…</p>`; }    

    // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ÙØ±Ø¯ÙŠ Ù…Ù† localStorage (Ù„Ù„Ø³Ø±Ø¹Ø©)
    const comments = JSON.parse(localStorage.getItem(`comments_${a.appId}`)) || [];    
    const majorityRating = getMajorityRating(comments);    
    const ratingHTML=`<div class="rating">${renderStars(majorityRating)}</div><div>(${a.experience} Ø³Ù†ÙˆØ§Øª Ø®Ø¨Ø±Ø©)</div>`;    

    card.innerHTML=`    
        <div class="card-header">    
            <img src="${a.img||'images/placeholder_profile.png'}" class="profile-img" alt="${a.name}">    
            <div>    
                <h3>${a.name}</h3>    
                ${ratingHTML}    
            </div>    
        </div>    
        <div class="card-details">${details}<p><strong>Ù†Ø¨Ø°Ø©:</strong> ${a.about}</p></div>    
        <button class="contact-btn" onclick="startChat('${a.appId}','${a.name}')">ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø§Ù„Ø¢Ù†</button>    
        <button class="comments-btn" onclick="openCommentsModal('${a.appId}','${a.name}')">ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</button>    
    `;    
    grid.appendChild(card);    
});

}

// Ø¯Ø§Ù„Ø© Ø§Ù„ÙÙ„ØªØ±Ø© (Ø§Ù„Ø¨Ø­Ø«)
function filterAssistants() {
    const searchTerm = document.getElementById('assistantSearch').value.toLowerCase();
    const filteredList = allAssistants.filter(a => {
        const nameMatch = a.name.toLowerCase().includes(searchTerm);
        const specializationMatch = (a.guideType || a.specialization || a.role || '').toLowerCase().includes(searchTerm);
        return nameMatch || specializationMatch;
    });
    renderCards(filteredList, document.getElementById('roleTitleDisplay').textContent);
}


// Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙÙŠ localStorage (Cashing Strategy)
document.addEventListener('DOMContentLoaded', async()=>{
const urlParams = new URLSearchParams(window.location.search);
const roleKey = urlParams.get('role');

const storageKey = roleKey ? `assistants_${roleKey}` : 'assistants_all';    
let cachedData = JSON.parse(localStorage.getItem(storageKey));    

// 1. Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹ (Ù„Ù„Ø³Ø±Ø¹Ø©)
if(cachedData){    
    allAssistants = cachedData;
    renderCards(allAssistants, roleKey ? ROLES[roleKey].name : "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†");    
}    

// 2. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© Ù…Ù† Firebase ÙˆØªØ®Ø²ÙŠÙ†Ù‡Ø§
try {
    let freshData = [];
    if(roleKey){    
        const snap = await get(ref(db,keyMap[roleKey]));    
        if(snap.exists()){    
            freshData = Object.values(snap.val());    
        }    
    } else {    
        const guides = (await get(ref(db,'assistants_guides'))).val() || {};    
        const companions = (await get(ref(db,'assistants_companions'))).val() || {};    
        const drivers = (await get(ref(db,'assistants_drivers'))).val() || {};    
        
        freshData = [...Object.values(guides),...Object.values(companions),...Object.values(drivers)];    
    }
    
    // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø®ØªÙ„ÙØ© Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶
    const freshDataString = JSON.stringify(freshData);
    if (freshDataString !== localStorage.getItem(storageKey)) {
        localStorage.setItem(storageKey, freshDataString);
        allAssistants = freshData;
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
        renderCards(allAssistants, roleKey ? ROLES[roleKey].name : "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†");
    }

} catch(error) {
    console.error("Error fetching fresh data from Firebase:", error);
    if (!cachedData) {
        document.getElementById('assistantCardsGrid').innerHTML = '<p style="text-align:center;color:var(--red-emergency);">ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„.</p>';
    }
}


});

// Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ØªÙ…Ø±Ø± ÙƒÙˆØ¯ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ (appId) Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø´Ø§Øª
function startChat(code,name){ window.location.href=`chat_page.html?code=${code}`; }

// ** Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ù„Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù… **
window.openCommentsModal = openCommentsModal;
window.closeCommentsModal = closeCommentsModal;
window.submitModalComment = submitModalComment;
window.startChat = startChat;
window.filterAssistants = filterAssistants;
window.deleteComment = deleteComment; // Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ù„Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù…

</script>
</body>
</html>

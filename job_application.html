<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù†Ø¶Ù… ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ø³ÙŠØ§Ø­ÙŠ</title>
<style>
:root {
    --dark-bg: #121212;
    --card-bg: #1f1f1f;
    --gold: #ffc107;
    --blue-royal: #4a6fa5;
    --white: #e0e0e0;
    --border-color: #333333;
    --red-emergency: #cf6679;
    --green-success: #4caf50;
    --yellow-warning: #ffeb3b;
    --text-color: #e0e0e0;
}
*, *::before, *::after {box-sizing:border-box; margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; direction:rtl;}
body {background: linear-gradient(145deg, var(--dark-bg) 0%, #1e272e 100%); color: var(--text-color); min-height:100vh; padding-bottom:50px;}
.container {max-width: 900px; margin:40px auto; padding:20px; background-color: var(--card-bg); border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.5); border:1px solid var(--border-color);}
h1,h2 {color: var(--gold); text-align:center; margin-bottom:20px; border-bottom:2px solid var(--blue-royal); padding-bottom:10px;}
p {text-align:center; margin-bottom:20px; color:#b0b0b0;}
.form-group {margin-bottom:20px;}
.form-group label {display:block; margin-bottom:8px; font-weight:bold; color:var(--white); padding-right:5px;}
input[type="text"], input[type="tel"], select, textarea {width:100%; padding:12px; border:1px solid var(--blue-royal); border-radius:6px; background-color:#2a2a2a; color:var(--white); font-size:1em; transition:border-color 0.3s, box-shadow 0.3s;}
input[type="file"] {width:100%; display:block; padding:12px; border:1px solid var(--blue-royal); border-radius:6px; background-color:#2a2a2a; color:var(--white); font-size:1em;}
input:focus, select:focus, textarea:focus {border-color: var(--gold); box-shadow:0 0 8px rgba(255,193,7,0.5); outline:none;}
select {appearance:none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23ffc107'%3e%3cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'/%3e%3c/svg%3e"); background-repeat:no-repeat; background-position:left 10px center;}
.btn-submit {background-color: var(--gold); color: var(--dark-bg); padding:12px 25px; border:none; border-radius:6px; cursor:pointer; font-size:1.1em; font-weight:bold; transition: background-color 0.3s, transform 0.1s;}
.btn-submit:hover {background-color:#e0a800; transform:translateY(-1px);}
.btn-submit:disabled {background-color:#4a4a4a; color:#999; cursor:not-allowed;}
.file-upload-info {color:#ccc; font-size:0.9em; margin-bottom:15px;}
.file-upload-info strong {color:var(--gold);}
.alert-warning {background-color:#5d4a0f; color:var(--yellow-warning); padding:8px; border-radius:5px; margin-top:5px; font-size:0.9em;}
#message-box {padding:15px; margin-top:20px; text-align:center; display:none; border-radius:5px; transition: all 0.3s ease;}
.header-controls {display:flex; justify-content:space-between; padding:15px; background-color:#1f1f1f; border-bottom:1px solid var(--border-color);}
.btn-back, #checkRequestBtn {background-color:var(--blue-royal); color:var(--white); padding:8px 15px; border-radius:6px; text-decoration:none; font-size:0.9em; transition:background-color 0.3s; border:none; cursor:pointer;}
.btn-back:hover, #checkRequestBtn:hover {background-color:#003366;}
</style>
</head>
<body>

<div class="header-controls">
    <div>
        <a href="index.html" class="btn-back">ğŸ”™ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="inquiry.html" id="checkRequestBtn">ğŸ“‹ Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø·Ù„Ø¨ Ø³Ø§Ø¨Ù‚</a>
    </div>
</div>

<div class="container" style="max-width:600px;">
<h1>Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ ÙƒÙ€ Ù…Ø³Ø§Ø¹Ø¯ Ø³ÙŠØ§Ø­ÙŠ ğŸ¤</h1>
<p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø£Ø¯Ù†Ø§Ù‡ Ø¨Ø¹Ù†Ø§ÙŠØ© ÙˆØ±ÙØ¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.</p>

<form id="applicationForm">
<div class="form-group">
<label for="fullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
<input type="text" id="fullName" required>
</div>

<div class="form-group">
<label for="phoneNumber">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
<input type="tel" id="phoneNumber" placeholder="Ù…Ø«Ø§Ù„: 97150xxxxxxx" required>
</div>

<div class="form-group">
<label for="address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
<input type="text" id="address" required>
</div>

<div class="form-group">
<label for="roleSelect">Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</label>
<select id="roleSelect" required>
<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¸ÙŠÙØ© --</option>
<option value="GUIDE">Ù…Ø±Ø´Ø¯ Ø³ÙŠØ§Ø­ÙŠ</option>
<option value="COMPANION">Ù…Ø±Ø§ÙÙ‚ Ù„Ø°ÙˆÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø®Ø§ØµØ©</option>
<option value="DRIVER">Ø³Ø§Ø¦Ù‚ Ù†Ù‚Ù„ Ø®Ø§Øµ</option>
</select>
</div>

<div id="fileUploadSection" class="files-upload-section">
<h2>ğŸ“‘ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h2>

<div id="commonFiles">
<p class="file-upload-info"><strong>Ù…Ø·Ù„ÙˆØ¨ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±:</strong></p>
<div class="form-group">
<label for="idFront">ğŸªª Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ© (ÙˆØ¬Ù‡) ğŸ“‚:</label>
<input type="file" id="idFront" accept="image/*,application/pdf" required>
</div>
<div class="form-group">
<label for="idBack">ğŸªª Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ© (Ø¸Ù‡Ø±) ğŸ“‚:</label>
<input type="file" id="idBack" accept="image/*,application/pdf" required>
</div>
<div class="form-group">
<label for="cv">ğŸ“„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© (CV) (PDF ÙÙ‚Ø·) ğŸ“‚:</label>
<input type="file" id="cv" accept="application/pdf" required>
</div>
</div>

<div id="guideFiles" style="display:none;">
<p class="file-upload-info"><strong>Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø±Ø´Ø¯ Ø§Ù„Ø³ÙŠØ§Ø­ÙŠ:</strong></p>
<div class="form-group">
<label for="licenseFront">ğŸš— Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ© (ÙˆØ¬Ù‡) ğŸ“‚:</label>
<input type="file" id="licenseFront" accept="image/*,application/pdf">
</div>
<div class="form-group">
<label for="licenseBack">ğŸš— Ø§Ù„Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ© (Ø¸Ù‡Ø±) ğŸ“‚:</label>
<input type="file" id="licenseBack" accept="image/*,application/pdf">
</div>
</div>

<div id="companionFiles" style="display:none;">
<p class="file-upload-info"><strong>Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø±Ø§ÙÙ‚ Ù„Ø°ÙˆÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø®Ø§ØµØ©:</strong></p>
<div class="form-group">
<label for="companionCard">ğŸ« ÙƒØ§Ø±Ù†ÙŠÙ‡ Ø³Ø§Ø¨Ù‚ (Ø¥Ù† ÙˆØ¬Ø¯) - Ø§Ø®ØªÙŠØ§Ø±ÙŠ ğŸ“‚:</label>
<input type="file" id="companionCard" accept="image/*,application/pdf">
</div>
</div>

<div id="driverFiles" style="display:none;">
<p class="file-upload-info"><strong>Ø®Ø§Øµ Ø¨Ø§Ù„Ø³Ø§Ø¦Ù‚ Ù†Ù‚Ù„ Ø®Ø§Øµ:</strong></p>
<div class="form-group">
<label for="driverLicenseFront">ğŸš— Ø±Ø®ØµØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø®Ø§ØµØ© (ÙˆØ¬Ù‡) ğŸ“‚:</label>
<input type="file" id="driverLicenseFront" accept="image/*,application/pdf">
</div>
<div class="form-group">
<label for="driverLicenseBack">ğŸš— Ø±Ø®ØµØ© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø®Ø§ØµØ© (Ø¸Ù‡Ø±) ğŸ“‚:</label>
<input type="file" id="driverLicenseBack" accept="image/*,application/pdf">
</div>
</div>
</div>

<button type="submit" class="btn-submit" style="width:100%; margin-top:30px;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
<div id="message-box"></div>
</form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDpVqFWJfB4rA2-NA4QIl1w07e2LFQaYic",
  authDomain: "tourguideapp-313c1.firebaseapp.com",
  databaseURL: "https://tourguideapp-313c1-default-rtdb.firebaseio.com",
  projectId: "tourguideapp-313c1",
  storageBucket: "tourguideapp-313c1.appspot.com",
  messagingSenderId: "1036127588385",
  appId: "1:1036127588385:web:d144dba8f70fe094395360"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

function fileToDataURL(file){return new Promise((resolve,reject)=>{if(!file){resolve(null);return;}const reader=new FileReader();reader.onload=()=>resolve(reader.result);reader.onerror=error=>reject(error);reader.readAsDataURL(file);});}

function toggleFileFields(){
    const roleKey = document.getElementById('roleSelect').value;
    const sections = {
        GUIDE: document.getElementById('guideFiles'),
        COMPANION: document.getElementById('companionFiles'),
        DRIVER: document.getElementById('driverFiles')
    };
    document.getElementById('commonFiles').style.display='block';
    Object.values(sections).forEach(sec=>{sec.style.display='none'; sec.querySelectorAll('input[type="file"]').forEach(inp=>inp.required=false);});
    if(roleKey && sections[roleKey]){sections[roleKey].style.display='block'; sections[roleKey].querySelectorAll('input[type="file"]').forEach(inp=>inp.required=true);}
}

async function getFilePaths(){
    const filesData={};
    const inputsToProcess=document.querySelectorAll('#fileUploadSection input[type="file"]');
    for(const input of inputsToProcess){
        const id=input.id;
        if(input.required && input.files.length===0) throw new Error(`Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${document.querySelector('label[for="'+id+'"]').textContent.trim()}`);
        if(input.files.length===0) continue;
        filesData[id]=[];
        for(const f of input.files) filesData[id].push(await fileToDataURL(f));
    }
    return filesData;
}

function generateApplicationId(){return Math.floor(10000+Math.random()*90000).toString();}

document.getElementById('roleSelect').addEventListener('change',toggleFileFields);

document.getElementById('applicationForm').addEventListener('submit',async e=>{
    e.preventDefault();
    const msgBox=document.getElementById('message-box');
    msgBox.style.display='block';
    msgBox.textContent='â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨...';
    msgBox.style.backgroundColor='var(--blue-royal)';
    const submitBtn=e.target.querySelector('button[type="submit"]');
    submitBtn.disabled=true;

    let filesData;
    try{filesData=await getFilePaths();}
    catch(error){submitBtn.disabled=false; msgBox.textContent=`âŒ ${error.message}`; msgBox.style.backgroundColor='var(--red-emergency)'; return;}

    const newId = generateApplicationId();
    const newApplication = {
        id: newId,
        fullName:document.getElementById('fullName').value.trim(),
        phoneNumber:document.getElementById('phoneNumber').value.trim(),
        address:document.getElementById('address').value.trim(),
        roleKey:document.getElementById('roleSelect').value,
        files:filesData,
        status:'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
        submissionTime:new Date().toLocaleString('ar-EG',{timeZone:'Africa/Cairo'})
    };

    try{
        const applicationsRef = ref(db,'jobApplications');
        const newAppRef = push(applicationsRef);
        await set(newAppRef, newApplication);

        msgBox.innerHTML=`âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ù‡Ùˆ <strong>${newId}</strong>.<br>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù… Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù„Ø§Ø­Ù‚Ø§Ù‹.`;
        msgBox.style.backgroundColor='var(--green-success)';
    }catch(err){
        console.error(err);
        msgBox.textContent='âŒ ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.';
        msgBox.style.backgroundColor='var(--red-emergency)';
    }

    submitBtn.disabled=false;
    toggleFileFields();
});

document.addEventListener('DOMContentLoaded',()=>{
    toggleFileFields();
});
</script>
</body>
</html>

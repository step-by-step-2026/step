<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ø§Ù„Ø³ÙŠØ§Ø­Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
<style>
:root {
    --dark-bg: #121212;
    --card-bg: #1f1f1f;
    --gold: #ffc107;
    --blue-royal: #004080;
    --white: #e0e0e0;
    --border-color: #333333;
    --red-emergency: #cf6679;
    --green-success: #4caf50;
    --text-color: #e0e0e0;
}

* { box-sizing:border-box; margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }

body {
    background: linear-gradient(145deg, var(--dark-bg) 0%, #1e272e 100%);
    color: var(--text-color);
    min-height: 100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:20px;
}

.container {
    max-width: 450px;
    width: 100%;
    padding: 30px;
    background-color: var(--card-bg);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    border:1px solid var(--border-color);
    text-align:center;
}

.logo {
    font-size:2em;
    color: var(--gold);
    font-weight:bold;
    margin-bottom: 25px;
}

p { margin-bottom:20px; color:#b0b0b0; }

input[type="text"] {
    width:100%;
    padding:12px;
    border-radius:6px;
    border:1px solid var(--blue-royal);
    background-color:#2a2a2a;
    color:var(--white);
    margin-bottom:15px;
    font-size:1em;
}

input:focus { border-color: var(--gold); outline:none; box-shadow:0 0 8px rgba(255,193,7,0.5); }

button {
    width:100%;
    padding:12px;
    border:none;
    border-radius:6px;
    font-size:1em;
    font-weight:bold;
    cursor:pointer;
    margin-bottom:15px;
    transition: background-color 0.3s;
}

#loginBtn {
    background-color: var(--blue-royal);
    color:white;
}

#loginBtn:hover { background-color:#003366; }

#message-box {
    min-height:40px;
    margin-bottom:10px;
    padding:10px;
    border-radius:6px;
    font-weight:bold;
    text-align:center;
    color:white;
    visibility:hidden;
}

#joinBtn {
    display:inline-block;
    text-decoration:none;
    background-color: var(--blue-royal);
    color:white;
    padding:12px 25px;
    border-radius:6px;
    font-weight:bold;
    transition: background-color 0.3s;
}

#joinBtn:hover { background-color:#003366; }
</style>
</head>
<body>

<div class="container">
    <div class="logo">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³ÙŠØ§Ø­Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ğŸ‡¦ğŸ‡ª</div>
    
    <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ ØªØ°ÙƒØ±ØªÙƒ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ø­.</p>

    <div id="message-box"></div>

    <input type="text" id="ticketCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ°ÙƒØ±Ø©">
    <button id="loginBtn">Ø¯Ø®ÙˆÙ„ â¡ï¸</button>

    <a id="joinBtn" href="job_application.html">Ø§Ù†Ø¶Ù… ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ø³ÙŠØ§Ø­ÙŠ ğŸ¤</a>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDpVqFWJfB4rA2-NA4QIl1w07e2LFQaYic",
  authDomain: "tourguideapp-313c1.firebaseapp.com",
  databaseURL: "https://tourguideapp-313c1-default-rtdb.firebaseio.com",
  projectId: "tourguideapp-313c1",
  storageBucket: "tourguideapp-313c1.firebasestorage.app",
  messagingSenderId: "1036127588385",
  appId: "1:1036127588385:web:d144dba8f70fe094395360"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const ticketsRef = ref(db, 'ticketCodes');

const messageBox = document.getElementById('message-box');
const loginBtn = document.getElementById('loginBtn');
const ticketInput = document.getElementById('ticketCode');

loginBtn.addEventListener('click', async () => {
    const code = ticketInput.value.trim();
    if(!code){
        messageBox.style.backgroundColor = '#cf6679';
        messageBox.textContent = "âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„ØªØ°ÙƒØ±Ø©.";
        messageBox.style.visibility = 'visible';
        return;
    }

    messageBox.style.backgroundColor = '#004080';
    messageBox.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ°ÙƒØ±Ø©...";
    messageBox.style.visibility = 'visible';

    try {
        const snapshot = await get(ticketsRef);
        const tickets = snapshot.exists() ? snapshot.val() : {};
        const now = new Date();

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ØªØ°ÙƒØ±Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
        const validTicket = Object.values(tickets).find(t => t.code === code && new Date(t.expiryDate) > now);

        if(validTicket){
            // Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒØ±Ø© ÙÙŠ sessionStorage
            sessionStorage.setItem('currentTicket', code);
            messageBox.style.backgroundColor = '#4caf50';
            messageBox.textContent = "âœ… Ø§Ù„ØªØ°ÙƒØ±Ø© ØµØ­ÙŠØ­Ø©ØŒ Ø¬Ø§Ø±ÙŠ ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø¯Ù…Ø§Øª...";
            setTimeout(() => {
                window.location.href = 'main_services.html';
            }, 1500);
        } else {
            messageBox.style.backgroundColor = '#cf6679';
            messageBox.textContent = "âŒ Ø§Ù„ØªØ°ÙƒØ±Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.";
        }
    } catch(err){
        console.error(err);
        messageBox.style.backgroundColor = '#cf6679';
        messageBox.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ°ÙƒØ±Ø©.";
    }
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ø§Ø¹Ø¯ Ø³ÙŠØ§Ø­ÙŠ</title>
<style>
.cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; margin-top: 30px; }
.assistant-card { background-color: #2a2a2a; border-radius: 10px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.4); border:1px solid #4a6fa5; position: relative; transition: transform 0.3s,border-color 0.3s; }
.assistant-card:hover { transform: translateY(-5px); border-color: #ffc107; }
.card-header { display:flex; align-items:center; margin-bottom:15px; border-bottom:1px dashed #444; padding-bottom:10px; }
.profile-img { width:70px; height:70px; border-radius:50%; object-fit:cover; border:2px solid #ffc107; margin-left:15px; }
.card-header h3 { color:#ffc107; margin:0; font-size:1.4em; }
.card-details p { margin:8px 0; text-align:right; font-size:0.95em; color:#ccc; }
.card-details strong { color:#fff; }
.rating { color: #ffeb3b; font-size:1.1em; margin-top:5px; line-height:1.2em; }
.contact-btn, .comments-btn { background-color:#4caf50; color:#121212; padding:10px; width:100%; border:none; border-radius:6px; font-weight:bold; margin-top:10px; cursor:pointer; transition: background-color 0.3s; }
.contact-btn:hover, .comments-btn:hover { background-color:#388e3c; }
.role-title { text-align:center; color:#fff; background-color:#4a6fa5; padding:10px; border-radius:8px; margin-bottom:20px; }
.comment-section { display:none; background-color:#1f1f1f; padding:10px; border-radius:6px; margin-top:10px; max-height:300px; overflow-y:auto; }
.comment-item { margin-bottom:8px; line-height:1.3em; padding-bottom:5px; border-bottom:1px dashed #444; }
.comment-name { font-weight:bold; color:#ffc107; display:block; margin-bottom:2px; }
.comment-stars { display:block; color:#ffeb3b; margin-bottom:2px; }
.comment-text { display:block; color:#ccc; text-align:right; }
.comment-input, .rating-select { width:100%; padding:6px; margin-top:5px; border-radius:4px; border:1px solid #4a6fa5; background-color:#2a2a2a; color:#fff; }
.comment-submit { margin-top:5px; padding:6px 12px; border:none; border-radius:6px; background-color:#4a6fa5; color:#fff; cursor:pointer; }
</style>
</head>
<body>
<div class="header-controls">
    <a href="main_services.html" class="btn-back">ğŸ”™ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
</div>
<div class="container" style="max-width:1000px;">
    <h1 id="pageHeading">Ø§Ù‡Ù„Ø§ Ø¨Ùƒ ÙŠØ§ Ø²Ø§Ø¦Ø±Ù†Ø§ Ø§Ù„Ø¹Ø²ÙŠØ²</h1>
    <div class="role-title" id="roleTitleDisplay">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ†</div>
    <div id="assistantCardsGrid" class="cards-grid"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, get, set, push } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDpVqFWJfB4rA2-NA4QIl1w07e2LFQaYic",
  authDomain: "tourguideapp-313c1.firebaseapp.com",
  databaseURL: "https://tourguideapp-313c1-default-rtdb.firebaseio.com",
  projectId: "tourguideapp-313c1",
  storageBucket: "tourguideapp-313c1.appspot.com",
  messagingSenderId: "1036127588385",
  appId: "1:1036127588385:web:d144dba8f70fe094395360"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const ROLES = {
    GUIDE:{key:'GUIDE',name:'Ù…Ø±Ø´Ø¯ Ø³ÙŠØ§Ø­ÙŠ'},
    COMPANION:{key:'COMPANION',name:'Ù…Ø±Ø§ÙÙ‚ Ù„Ø°ÙˆÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø®Ø§ØµØ©'},
    DRIVER:{key:'DRIVER',name:'Ø³Ø§Ø¦Ù‚ Ù†Ù‚Ù„ Ø®Ø§Øµ'}
};

// Ù…Ø«Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªØ© (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø§Ù„Ù€ Firebase)
let assistantsList = [
  {chatCode:'a1',name:'Ø£Ø­Ù…Ø¯',role:'GUIDE',guideType:'Ø«Ù‚Ø§ÙÙŠ',groupLimit:10,price:100,experience:5,about:'Ù…Ø±Ø´Ø¯ Ù…Ù…ØªØ§Ø²',img:'images/guide_man.png'},
  {chatCode:'b2',name:'Ù„ÙŠÙ„Ù‰',role:'COMPANION',specialization:'Ø³Ù…Ø¹ÙŠ',priceDay:80,priceHour:20,experience:3,about:'Ù…Ø±Ø§ÙÙ‚Ø© Ù…Ù…ØªØ§Ø²Ø©',img:'images/companion_woman.png'},
  {chatCode:'c3',name:'Ø³Ø¹ÙŠØ¯',role:'DRIVER',cityPrice:50,outCityPrice:80,experience:7,about:'Ø³Ø§Ø¦Ù‚ Ø°Ùˆ Ø®Ø¨Ø±Ø©',img:'images/driver_man.png'}
];

function renderStars(rating){
  let stars='';
  for(let i=1;i<=5;i++) stars+=i<=rating?'â­':'â˜†';
  return stars;
}

async function loadComments(code){
  const div=document.querySelector(`#comments-${code} .comments-list`);
  div.innerHTML='';
  const snap = await get(ref(db, `assistantComments/${code}`));
  const comments = snap.exists()?Object.values(snap.val()):[];
  comments.slice(-20).forEach(c=>{
    const el=document.createElement('div');
    el.className='comment-item';
    el.innerHTML=`<span class="comment-name">${c.name}</span><span class="comment-stars">${'â­'.repeat(c.rating)}</span><span class="comment-text">${c.text}</span>`;
    div.appendChild(el);
  });
}

async function submitComment(code){
  const nameInput=document.getElementById(`comment-name-${code}`);
  const textInput=document.getElementById(`comment-input-${code}`);
  const ratingSelect=document.getElementById(`comment-rating-${code}`);
  const name=nameInput.value.trim()||'Ø²Ø§Ø¦Ø±';
  const text=textInput.value.trim();
  const rating=parseInt(ratingSelect.value);
  if(!text) return alert('âŒ ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© ØªØ¹Ù„ÙŠÙ‚');
  await set(push(ref(db, `assistantComments/${code}`)), {name,text,rating});
  nameInput.value=''; textInput.value=''; ratingSelect.value='5';
  await loadComments(code);
  alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ø¨Ù†Ø¬Ø§Ø­');
}

function toggleComments(code){
  const sec=document.getElementById(`comments-${code}`);
  sec.style.display=sec.style.display==='block'?'none':'block';
}

function startChat(code,name){
  window.location.href=`chat_page.html?code=${code}&name=${encodeURIComponent(name)}`;
}

async function renderCards(list){
  const grid=document.getElementById('assistantCardsGrid');
  grid.innerHTML='';
  for(const a of list){
    const card=document.createElement('div');
    card.className='assistant-card';
    card.innerHTML=`
      <div class="card-header">
        <img src="${a.img}" class="profile-img">
        <div><h3>${a.name}</h3><div class="rating">${renderStars(5)}</div><div>(${a.experience} Ø³Ù†ÙˆØ§Øª Ø®Ø¨Ø±Ø©)</div></div>
      </div>
      <div class="card-details">
        ${a.guideType?`<p><strong>Ø§Ù„ØªØ®ØµØµ:</strong>${a.guideType}</p><p><strong>Ø­Ø¯ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</strong>${a.groupLimit}</p><p><strong>Ø³Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…:</strong>${a.price}</p>`:''}
        ${a.specialization?`<p><strong>Ø§Ù„ØªØ®ØµØµ:</strong>${a.specialization}</p><p><strong>Ø³Ø¹Ø± Ø§Ù„ÙŠÙˆÙ…:</strong>${a.priceDay}</p><p><strong>Ø³Ø¹Ø± Ø§Ù„Ø³Ø§Ø¹Ø©:</strong>${a.priceHour}</p>`:''}
        ${a.cityPrice?`<p><strong>Ø£Ø¬Ø±Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong>${a.cityPrice}</p><p><strong>Ø£Ø¬Ø±Ø© Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong>${a.outCityPrice}</p>`:''}
        <p><strong>Ù†Ø¨Ø°Ø©:</strong>${a.about}</p>
      </div>
      <button class="contact-btn" onclick="startChat('${a.chatCode}','${a.name}')">ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø§Ù„Ø¢Ù†</button>
      <button class="comments-btn" onclick="toggleComments('${a.chatCode}')">ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</button>
      <div class="comment-section" id="comments-${a.chatCode}">
        <button style="float:left;margin-bottom:5px;" onclick="toggleComments('${a.chatCode}')">âœ–</button>
        <div class="comments-list"></div>
        <input type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ..." class="comment-input" id="comment-name-${a.chatCode}">
        <input type="text" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹..." class="comment-input" id="comment-input-${a.chatCode}">
        <select class="rating-select" id="comment-rating-${a.chatCode}">
          <option value="1">â­ 1</option>
          <option value="2">â­ 2</option>
          <option value="3">â­ 3</option>
          <option value="4">â­ 4</option>
          <option value="5" selected>â­ 5</option>
        </select>
        <button class="comment-submit" onclick="submitComment('${a.chatCode}')">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚</button>
      </div>
    `;
    grid.appendChild(card);
    await loadComments(a.chatCode);
  }
}

document.addEventListener('DOMContentLoaded',()=>{
  renderCards(assistantsList);
});
</script>
</body>
</html>
